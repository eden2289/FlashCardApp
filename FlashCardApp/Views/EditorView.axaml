<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:FlashCardApp.ViewModels"
             xmlns:models="using:FlashCardApp.Models"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="FlashCardApp.Views.EditorView"
             x:DataType="vm:EditorViewModel"
             Background="#121212">
    
    <Design.DataContext>
        <vm:EditorViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header Section -->
        <StackPanel Grid.Row="0" Margin="20,20,20,10" Spacing="16">
            <!-- Page Title -->
            <TextBlock Text="{Binding PageTitle}" 
                       FontSize="28" 
                       FontWeight="Bold"
                       Foreground="White"/>
            
            <!-- Deck Name Input -->
            <StackPanel Spacing="8">
                <TextBlock Text="Deck Name" 
                           FontSize="14" 
                           Foreground="#A0A0A0"/>
                <TextBox Text="{Binding CurrentDeck.Name, Mode=TwoWay}"
                         FontSize="16"
                         Padding="12"
                         Background="#1E1E1E"
                         Foreground="White"
                         BorderBrush="#333333"
                         BorderThickness="1"
                         CornerRadius="6"
                         Watermark="Enter deck name..."/>
            </StackPanel>
        </StackPanel>

        <!-- Cards List -->
        <ScrollViewer Grid.Row="1" 
                      Padding="20,10" 
                      VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="12">
                <TextBlock Text="Cards" 
                           FontSize="18" 
                           FontWeight="SemiBold"
                           Foreground="White"
                           Margin="0,0,0,8"/>
                
                <ItemsControl ItemsSource="{Binding CardViewModels}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Spacing="12"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vm:FlashcardEditorViewModel">
                            <Border Background="#1E1E1E"
                                    CornerRadius="8"
                                    Padding="16"
                                    BorderBrush="#333333"
                                    BorderThickness="1">
                                <Grid RowDefinitions="Auto,Auto">
                                    <Grid Grid.Row="0" ColumnDefinitions="*,16,*,16,Auto">
                                        <!-- è©žèªž + æŸ¥è©¢æŒ‰éˆ• -->
                                        <StackPanel Grid.Column="0" Spacing="6">
                                            <TextBlock Text="è©žèªž" 
                                                       FontSize="12" 
                                                       Foreground="#A0A0A0"/>
                                            <Grid ColumnDefinitions="*,8,Auto">
                                                <TextBox Grid.Column="0"
                                                         Text="{Binding Front, Mode=TwoWay}"
                                                         FontSize="14"
                                                         Padding="10"
                                                         Background="#2A2A2A"
                                                         Foreground="White"
                                                         BorderBrush="#444444"
                                                         BorderThickness="1"
                                                         CornerRadius="4"
                                                         Watermark="è¼¸å…¥è‹±æ–‡å–®å­—..."
                                                         MinHeight="44"/>
                                                <!-- æŸ¥è©¢æŒ‰éˆ• -->
                                                <Button Grid.Column="2"
                                                        Command="{Binding LookupWordCommand}"
                                                        Width="44"
                                                        Height="44"
                                                        CornerRadius="4"
                                                        Background="#6200EE"
                                                        BorderThickness="0"
                                                        Cursor="Hand"
                                                        ToolTip.Tip="æŸ¥è©¢å–®å­—å®šç¾©"
                                                        IsEnabled="{Binding !IsLoading}">
                                                    <Panel>
                                                        <TextBlock Text="ðŸ”" 
                                                                   FontSize="16"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"
                                                                   IsVisible="{Binding !IsLoading}"/>
                                                        <TextBlock Text="â³" 
                                                                   FontSize="16"
                                                                   HorizontalAlignment="Center"
                                                                   VerticalAlignment="Center"
                                                                   IsVisible="{Binding IsLoading}"/>
                                                    </Panel>
                                                </Button>
                                            </Grid>
                                            <!-- éŒ¯èª¤è¨Šæ¯ -->
                                            <TextBlock Text="{Binding ErrorMessage}"
                                                       FontSize="12"
                                                       Foreground="#F44336"
                                                       IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                        </StackPanel>
                                        
                                        <!-- å®šç¾© -->
                                        <StackPanel Grid.Column="2" Spacing="6">
                                            <TextBlock Text="å®šç¾©" 
                                                       FontSize="12" 
                                                       Foreground="#A0A0A0"/>
                                            <TextBox Text="{Binding Back, Mode=TwoWay}"
                                                     FontSize="14"
                                                     Padding="10"
                                                     Background="#2A2A2A"
                                                     Foreground="White"
                                                     BorderBrush="#444444"
                                                     BorderThickness="1"
                                                     CornerRadius="4"
                                                     Watermark="è¼¸å…¥å®šç¾©..."
                                                     TextWrapping="Wrap"
                                                     AcceptsReturn="True"
                                                     MinHeight="60"/>
                                        </StackPanel>
                                        
                                        <!-- Delete Button -->
                                        <Button Grid.Column="4"
                                                Command="{Binding $parent[ItemsControl].((vm:EditorViewModel)DataContext).RemoveCardCommand}"
                                                CommandParameter="{Binding}"
                                                Width="40"
                                                Height="40"
                                                CornerRadius="20"
                                                Background="#D32F2F"
                                                BorderThickness="0"
                                                VerticalAlignment="Center"
                                                Cursor="Hand"
                                                ToolTip.Tip="ç§»é™¤å¡ç‰‡">
                                            <TextBlock Text="ðŸ—‘" 
                                                       FontSize="16"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"/>
                                        </Button>
                                    </Grid>
                                    
                                    <!-- å»ºè­°åˆ—è¡¨ï¼ˆå¯æ»‘å‹•å‹¾é¸ï¼‰ -->
                                    <Border Grid.Row="1"
                                            IsVisible="{Binding ShowSuggestions}"
                                            Background="#2A2A2A"
                                            CornerRadius="6"
                                            Margin="0,12,56,0"
                                            BorderBrush="#6200EE"
                                            BorderThickness="1"
                                            MaxHeight="200">
                                        <Grid RowDefinitions="Auto,*,Auto">
                                            <!-- æ¨™é¡Œåˆ— -->
                                            <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto,Auto" Margin="12,8">
                                                <TextBlock Grid.Column="0"
                                                           Text="é¸æ“‡è©žç¾©ï¼ˆå¯å¤šé¸ï¼‰"
                                                           FontSize="13"
                                                           FontWeight="SemiBold"
                                                           Foreground="#A0A0A0"
                                                           VerticalAlignment="Center"/>
                                                <Button Grid.Column="2"
                                                        Command="{Binding SelectAllCommand}"
                                                        Content="å…¨é¸"
                                                        FontSize="11"
                                                        Padding="8,4"
                                                        Background="#3A3A3A"
                                                        Foreground="#6200EE"
                                                        BorderThickness="0"
                                                        CornerRadius="4"
                                                        Cursor="Hand"
                                                        Margin="0,0,6,0"/>
                                                <Button Grid.Column="3"
                                                        Command="{Binding HideSuggestionsCommand}"
                                                        Background="Transparent"
                                                        BorderThickness="0"
                                                        Padding="6"
                                                        Cursor="Hand">
                                                    <TextBlock Text="âœ•" FontSize="14" Foreground="#888888"/>
                                                </Button>
                                            </Grid>
                                            
                                            <!-- å¯æ»‘å‹•çš„å‹¾é¸åˆ—è¡¨ -->
                                            <ScrollViewer Grid.Row="1" 
                                                          VerticalScrollBarVisibility="Auto"
                                                          Padding="8,0">
                                                <ItemsControl ItemsSource="{Binding Suggestions}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate x:DataType="models:WordDefinition">
                                                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                      Margin="4,6"
                                                                      Cursor="Hand">
                                                                <CheckBox.Styles>
                                                                    <Style Selector="CheckBox">
                                                                        <Setter Property="Foreground" Value="White"/>
                                                                    </Style>
                                                                    <Style Selector="CheckBox:pointerover /template/ ContentPresenter">
                                                                        <Setter Property="Foreground" Value="#BB86FC"/>
                                                                    </Style>
                                                                </CheckBox.Styles>
                                                                <TextBlock Text="{Binding DisplayText}"
                                                                           FontSize="14"
                                                                           Foreground="White"
                                                                           VerticalAlignment="Center"/>
                                                            </CheckBox>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>
                                            
                                            <!-- ç¢ºèªæŒ‰éˆ• -->
                                            <Button Grid.Row="2"
                                                    Command="{Binding ConfirmSelectionCommand}"
                                                    Content="ç¢ºèªé¸æ“‡"
                                                    HorizontalAlignment="Stretch"
                                                    Margin="8,8"
                                                    Padding="12,10"
                                                    FontSize="14"
                                                    FontWeight="SemiBold"
                                                    Background="#6200EE"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    CornerRadius="6"
                                                    Cursor="Hand"
                                                    IsEnabled="{Binding HasSelection}">
                                                <Button.Styles>
                                                    <Style Selector="Button:disabled">
                                                        <Setter Property="Opacity" Value="0.5"/>
                                                    </Style>
                                                </Button.Styles>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- Add Card Button -->
                <Button Command="{Binding AddCardCommand}"
                        HorizontalAlignment="Center"
                        Margin="0,16,0,40"
                        Padding="20,12"
                        Background="#2A2A2A"
                        BorderBrush="#6200EE"
                        BorderThickness="2"
                        CornerRadius="8"
                        Cursor="Hand">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="+" 
                                   FontSize="18" 
                                   FontWeight="Bold"
                                   Foreground="#6200EE"/>
                        <TextBlock Text="Add Card" 
                                   FontSize="14" 
                                   Foreground="#6200EE"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer Actions -->
        <Border Grid.Row="2" 
                Background="#1A1A1A"
                Padding="20"
                BorderBrush="#333333"
                BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Right"
                        Spacing="12">
                <!-- Cancel Button -->
                <Button Command="{Binding CancelCommand}"
                        Padding="24,12"
                        Background="Transparent"
                        BorderBrush="#666666"
                        BorderThickness="1"
                        CornerRadius="6"
                        Cursor="Hand">
                    <TextBlock Text="Cancel" 
                               FontSize="14" 
                               Foreground="#A0A0A0"/>
                </Button>
                
                <!-- Save Button -->
                <Button Command="{Binding SaveCommand}"
                        Padding="24,12"
                        Background="#6200EE"
                        BorderThickness="0"
                        CornerRadius="6"
                        Cursor="Hand">
                    <TextBlock Text="Save" 
                               FontSize="14" 
                               FontWeight="SemiBold"
                               Foreground="White"/>
                </Button>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
